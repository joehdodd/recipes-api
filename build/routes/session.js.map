{"version":3,"sources":["../../src/routes/session.js"],"names":["router","post","req","res","next","body","username","password","context","models","User","findByLogin","user","status","json","message","bcrypt","compare","passwordMatch","payload","id","token","jwt","sign","process","env","KEY","cookie","domain","maxAge","send","error"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA,SAAS,sBAAf;;AAEAA,OAAOC,IAAP,CAAY,GAAZ;AAAA,qEAAiB,iBAAeC,GAAf,EAAoBC,GAApB,EAAyBC,IAAzB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,wBACgBF,IAAIG,IADpB,EACPC,QADO,aACPA,QADO,EACGC,QADH,aACGA,QADH;;AAAA,kBAGXD,YAAYC,QAHD;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAIML,IAAIM,OAAJ,CAAYC,MAAZ,CAAmBC,IAAnB,CAAwBC,WAAxB,CAAoCL,QAApC,CAJN;;AAAA;AAIPM,gBAJO;;AAAA,kBAMTA,SAAS,IAAT,IAAiB,CAACA,IANT;AAAA;AAAA;AAAA;;AAAA,6CAOJT,IAAIU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,SAAS,gBAAX,EAA6BH,UAA7B,EAArB,CAPI;;AAAA;AAAA;AAAA,mBAUeI,iBAAOC,OAAP,CAAeV,QAAf,EAAyBK,KAAKL,QAA9B,CAVf;;AAAA;AAUPW,yBAVO;;AAAA,iBAYTA,aAZS;AAAA;AAAA;AAAA;;AAaLC,mBAbK,GAaK,EAAEC,IAAIR,KAAKQ,EAAX,EAbL;AAcLC,iBAdK,GAcGC,uBAAIC,IAAJ,CAASJ,OAAT,EAAkBK,QAAQC,GAAR,CAAYC,GAA9B,CAdH;;AAeXvB,gBAAIwB,MAAJ,CAAW,SAAX,EAAsBN,KAAtB,EAA6B;AAC3BO,sBAAQ,cADmB;AAE3BC,sBAAQ;AAFmB,aAA7B;AAfW,6CAmBJ1B,IAAIU,MAAJ,CAAW,GAAX,EAAgBiB,IAAhB,CAAqB,EAAElB,UAAF,EAArB,CAnBI;;AAAA;AAAA,6CAqBJT,IACJU,MADI,CACG,GADH,EAEJC,IAFI,CAEC,EAAEC,SAAS,oBAAX,EAAiCgB,OAAO,IAAxC,EAFD,CArBI;;AAAA;AAAA;AAAA;;AAAA;AAAA,6CA0BN5B,IAAIU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,SAAS,iCAAX,EAArB,CA1BM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAjB;;AAAA;AAAA;AAAA;AAAA;;kBA8Bef,M","file":"session.js","sourcesContent":["import { Router } from 'express';\nimport jwt from 'jsonwebtoken';\nimport bcrypt from 'bcrypt';\n\nconst router = Router();\n\nrouter.post('/', async function(req, res, next) {\n  const { username, password } = req.body;\n\n  if (username && password) {\n    const user = await req.context.models.User.findByLogin(username);\n\n    if (user === null || !user) {\n      return res.status(401).json({ message: 'User not found', user });\n    }\n\n    const passwordMatch = await bcrypt.compare(password, user.password);\n\n    if (passwordMatch) {\n      const payload = { id: user.id };\n      const token = jwt.sign(payload, process.env.KEY);\n      res.cookie('JWTAuth', token, {\n        domain: 'recipes.casa',\n        maxAge: 604800000\n      });\n      return res.status(200).send({ user });\n    } else {\n      return res\n        .status(401)\n        .json({ message: 'Incorrect password', error: true });\n    }\n  } else {\n    return res.status(401).json({ message: 'Username and password reqiured.' });\n  }\n});\n\nexport default router;\n"]}